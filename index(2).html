<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ— åŒå¿— â€” Vue UI</title>

  </head>

<body>

  <div id="app">
    <h3 style="color: #8c3333; font-family: sans-serif; padding: 20px;">
      æ­£åœ¨åŠ è½½ æ— åŒå¿— UI...
    </h3>
  </div>

  <link rel="stylesheet" href="https://at.alicdn.com/t/c/font_5058414_apch79jw7rj.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Merriweather:ital,wght@0,400;1,400&family=Noto+Sans+SC:wght@400;500;700&family=Almendra+SC&family=Cinzel+Decorative:wght@700&family=EB+Garamond&family=Josefin+Sans&family=Playfair+Display&family=Roboto+Slab&family=Spectral&display=swap">

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/pinia@2/dist/pinia.iife.prod.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js" async></script>

  <style>
    /* --- 1. å…¨å±€ CSS (æ¥è‡ª main.css) --- */
    :root {
      /* â€œæ°´å¢¨æš—çº¢â€ä¸­å›½é£ä¸»é¢˜ */
      --theme-background: #fcfaf5;
      --theme-background-secondary: #f9f5f0;
      --theme-background-tertiary: #fdfcf9;
      --theme-main-border: #5a4a42;
      --theme-border-dark: #dcd5c8;
      --theme-border-light: #e7e0d7;
      --theme-text-primary: #3a332d;
      --theme-text-secondary: #6e5e54;
      --theme-text-tertiary: #8c3333;
      --theme-title-bg: #f9f5f0;
      --theme-title-bg-hover: #f2ece4;
      --theme-open-bg: #e9e2d9;
      --theme-open-border-color: #5a4a42;
      --theme-star-active: #f7d75a;
      --theme-star-inactive: #a39a90;
      --theme-disabled-bg: #e8e4e0;
      --theme-disabled-text: #b5aaa2;
      --theme-background-tertiary-opacity: 0.9;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    /* åŸºç¡€é¡µé¢èƒŒæ™¯ (æ¨¡ä»¿æ—§ç‰ˆ) */
    body {
      font-family: 'EB Garamond', 'Noto Sans SC', serif;
      color: #4a3b2a;
      background: #f7f3ee;
      padding: 20px;
    }
    .value-main {
      font-weight: 500;
      color: var(--theme-text-primary);
    }
    .property-name {
      font-weight: bold;
      color: var(--theme-text-tertiary);
    }
    .empty-state-text {
      color: #888;
      font-style: italic;
      opacity: 0.8;
      padding: 15px;
    }

    /* --- 2. App.vue CSS --- */
    .layout[data-v-app] {
      display: flex;
      flex-direction: column;
      padding: 15px;
      background-color: var(--theme-background);
      opacity: var(--theme-background-opacity, 1);
      border: var(--theme-main-border-width, 2px) solid var(--theme-main-border);
      border-radius: 8px;
      overflow: hidden;
      max-width: 920px;
      margin: 0 auto;
    }

    /* --- 3. CommonStatus.vue CSS --- */
    .details-status[data-v-common-status] {
      margin-bottom: 6px;
      border: 1px solid var(--theme-border-light);
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
      transition: all .3s ease-in-out;
    }
    .details-status[data-v-common-status]:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,.25);
    }
    .details-status.locked .summary[data-v-common-status] {
      background-color: var(--theme-disabled-bg);
      color: var(--theme-disabled-text);
      cursor: not-allowed;
    }
    .details-status.locked .summary .icon-star[data-v-common-status] {
      color: var(--theme-disabled-text);
    }
    .summary[data-v-common-status] {
      font-family: "Cinzel", serif;
      font-weight: 700;
      color: var(--theme-text-tertiary);
      background-color: var(--theme-title-bg);
      padding: 4px 15px;
      cursor: pointer;
      list-style: none;
      border-bottom: 1px solid var(--theme-border-dark);
      text-align: left;
      transition: background-color .2s ease, color .2s ease;
    }
    .summary[data-v-common-status]:hover {
      background-color: var(--theme-title-bg-hover);
      color: var(--theme-text-primary);
    }
    .is-open .summary[data-v-common-status] {
      background-color: var(--theme-open-bg);
      border-bottom-color: var(--theme-open-border-color);
    }
    .summary.has-wrapped-summary[data-v-common-status] {
      padding-bottom: 8px;
    }
    .summary-main-line[data-v-common-status] {
      display: flex;
      align-items: center;
      width: 100%;
    }
    .icon-star[data-v-common-status] {
      font-size: 1.25em;
      color: var(--theme-star-inactive);
      text-shadow: none;
      margin-right: 12px;
      flex-shrink: 0;
      transform-origin: center center;
      transition: transform .4s cubic-bezier(0.68,-0.55,.27,1.55), color .4s ease, text-shadow .4s ease;
      display: inline-block;
      text-align: center;
      width: 1.2em;
      vertical-align: -0.15em;
    }
    .icon-star.is-open[data-v-common-status] {
      transform: rotate(360deg);
      color: var(--theme-star-active);
      text-shadow: 0 0 3px hsla(0,0%,100%,.8), 0 0 6px var(--theme-star-active), 0 0 10px #e5a50a;
    }
    .summary-title[data-v-common-status] {
      flex: 1;
    }
    .summary-details[data-v-common-status] {
      margin-left: auto;
      padding-right: 15px;
      font-family: "Noto Sans SC", "Courier New", monospace;
      font-weight: 500;
      font-size: .8em;
      color: var(--theme-text-secondary);
      letter-spacing: .5px;
      text-shadow: 0 0 1px rgba(0,0,0,.05);
      align-self: center;
      flex-shrink: 0;
    }
    .summary-wrapped-details[data-v-common-status] {
      margin-top: 6px;
      padding-left: 22px;
      padding-right: 10px;
      font-family: "Noto Sans SC", "Courier New", monospace;
      font-weight: 500;
      font-size: .8em;
      color: var(--theme-text-secondary);
      letter-spacing: .5px;
      text-shadow: 0 0 1px rgba(0,0,0,.05);
      line-height: 1.4;
      word-break: auto-phrase;
    }
    .arrow-toggle[data-v-common-status] {
      transition: transform .2s ease-in-out;
      font-size: .8em;
      padding-left: 5px;
      margin-left: auto;
      flex-shrink: 0;
    }
    .arrow-toggle.rotated[data-v-common-status] {
      transform: rotate(90deg);
    }
    .details-content[data-v-common-status] {
      background-color: var(--theme-background-tertiary);
      opacity: var(--theme-background-tertiary-opacity);
      overflow: hidden;
    }
    .details-content-inner[data-v-common-status] {
      padding: 15px;
      text-align: left;
      font-size: .9em;
    }
    .details-sub-section .details-content-inner[data-v-common-status] {
      padding-top: 5px;
      padding-bottom: 5px;
    }
    .details-entry .summary[data-v-common-status] {
      padding-top: .8px;
      padding-bottom: .8px;
      font-size: .9em;
    }
    .details-entry .details-content-inner[data-v-common-status] {
      padding: 10px 15px;
    }
    .collapse-enter-active[data-v-common-status],
    .collapse-leave-active[data-v-common-status] {
      transition: height .2s ease-in-out;
      overflow: hidden;
    }
    .collapse-enter-from[data-v-common-status],
    .collapse-leave-to[data-v-common-status] {
      height: 0 !important;
    }

    /* --- 4. WsHeader.vue CSS --- */
    .scroll-header[data-v-header] {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--theme-main-border);
      margin-bottom: 20px;
    }
    .master-ui-title h1[data-v-header] {
      font-family: 'Cinzel Decorative', serif;
      font-size: 2.8em;
      font-weight: 700;
      margin: 0;
      color: var(--theme-text-tertiary);
      text-shadow: none;
    }
    .scroll-poem-container h1[data-v-header] {
      font-family: 'Cinzel Decorative', serif;
      font-size: 1.8em;
      color: var(--theme-text-tertiary);
      text-shadow: none;
    }
    .scroll-poem-container[data-v-header] {
      text-align: right;
    }
    .poem-grid[data-v-header] {
      display: grid;
      grid-template-columns: auto auto;
      gap: 5px 20px;
      padding: 10px 0;
      font-family: 'Noto Sans SC', serif;
      font-size: 1.0em;
      color: var(--theme-text-secondary);
      text-align: right;
    }
    .poem-grid p[data-v-header] {
      margin: 0;
    }
    
    /* --- 5. WsWorld.vue CSS --- */
    .world-status[data-v-world] {
      display: flex;
      flex-direction: column;
      gap: 8px;
      background-color: var(--theme-background-secondary);
      padding: 10px 15px;
      margin-bottom: 15px;
      border: 1px solid var(--theme-border-dark);
      border-radius: 4px;
      box-shadow: 0 2px 5px #0000001a;
      transition: transform .2s ease-in-out,box-shadow .2s ease-in-out
    }
    .world-status[data-v-world]:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 10px #0003
    }
    .world-info[data-v-world] {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 6px;
      line-height: 1.6
    }
    .info-icon[data-v-world] {
      flex-shrink: 0;
      line-height: 1;
      font-size: 1.2em;
      width: 1.2em;
      text-align: center;
      vertical-align: -0.15em;
      color: var(--theme-text-secondary);
    }
    .info-label[data-v-world] {
      font-weight: 500;
      color: var(--theme-text-primary);
      flex-shrink: 0;
      line-height: 1
    }
    .value-main[data-v-world] { 
      font-weight: 500; 
      color: var(--theme-text-primary); 
    }
    
    
    /* --- 6. Protagonist, Hangnang, Fates, News (å…±äº«çš„ CSS) --- */
    .ws-section-content[data-v-char] { 
      padding: 15px; 
    }
    .ws-section-content.no-padding[data-v-char] { 
      padding: 0; 
    }
    .ws-sub-section-content[data-v-char] { 
      padding: 10px 15px; 
    }
    .char-property-grid[data-v-char] {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 8px 15px;
      align-items: center;
    }
    .char-icon[data-v-char] { 
      opacity: .8; 
      color: var(--theme-text-secondary);
      font-size: 1.2em;
      width: 1.2em;
      text-align: center;
      vertical-align: -0.15em;
    }
    .char-prop-name[data-v-char] {
      font-weight: 700;
      color: var(--theme-text-tertiary);
    }
    .char-prop-value[data-v-char] {
        font-weight: 500; 
        color: var(--theme-text-primary);
    }
    hr[data-v-char] {
      border: 0;
      height: 1px;
      background-image: linear-gradient(to right, transparent, rgba(74,59,42,.2), transparent);
      margin: 15px 0;
    }
    h4[data-v-char] {
      font-family: 'Cinzel', serif;
      color: var(--theme-text-tertiary);
      font-weight: 700;
      margin-bottom: 10px;
    }
    .item-row[data-v-char] {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid rgba(74,59,42,.1);
    }
    .ws-sub-section-content[data-v-news-content] {
      padding: 10px 15px; 
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>

  <script>
    // ç«‹å³æ‰§è¡Œå‡½æ•° (IIFE), é¿å…æ±¡æŸ“å…¨å±€
    (function () {
      
      // [!!] å…³é”®: å¯åŠ¨å™¨ (Bootloader) [!!]
      // æˆ‘ä»¬å¿…é¡»ç­‰å¾… Vue, Pinia, å’Œ Lodash å…¨éƒ¨åŠ è½½å®Œæ¯•
      
      let bootAttempts = 0;
      const maxBootAttempts = 200; // ç­‰å¾… 2 ç§’é’Ÿ (200 * 10ms)

      function checkLibsAndBoot() {
        bootAttempts++;
        
        // æ£€æŸ¥æ‰€æœ‰åº“æ˜¯å¦éƒ½å·²åœ¨ window ä¸Šå®šä¹‰
        if (window.Vue && window.Pinia && window._) {
          // æˆåŠŸ! åº“éƒ½å·²åŠ è½½ï¼Œå¯åŠ¨ App
          console.log('--- [æ— åŒå¿— ä¼ ç»Ÿç‰ˆ] ä¾èµ–åº“åŠ è½½æˆåŠŸ ---');
          mountVueApp();
        } else if (bootAttempts > maxBootAttempts) {
          // è¶…æ—¶
          console.error('--- [æ— åŒå¿— ä¼ ç»Ÿç‰ˆ] ä¾èµ–åº“åŠ è½½è¶…æ—¶ ---');
          var errorMsg = 'é”™è¯¯: ä¾èµ–åº“åŠ è½½è¶…æ—¶ã€‚';
          if (!window.Vue) errorMsg = 'é”™è¯¯: Vue.js æœªèƒ½åŠ è½½ã€‚';
          else if (!window.Pinia) errorMsg = 'é”™è¯¯: Pinia.js æœªèƒ½åŠ è½½ã€‚';
          else if (!window._) errorMsg = 'é”™è¯¯: Lodash.js æœªèƒ½åŠ è½½ã€‚';
          
          var appDiv = document.getElementById('app');
          if (appDiv) {
            appDiv.innerHTML = '<h3 style=\"color: red; font-family: sans-serif;\">' + errorMsg + '</h3>';
          }
        } else {
          // åº“å°šæœªåŠ è½½ï¼Œ10 æ¯«ç§’åé‡è¯•
          setTimeout(checkLibsAndBoot, 10);
        }
      }
      
      // [!!] å¯åŠ¨å‡½æ•° [!!]
      // åªæœ‰åœ¨ checkLibsAndBoot() ç¡®è®¤æ‰€æœ‰åº“éƒ½OKåï¼Œæ‰ä¼šè°ƒç”¨æ­¤å‡½æ•°
      function mountVueApp() {
        
        // --- 1. å®šä¹‰åˆ«å ---
        const { createApp, ref, computed, defineComponent, onMounted, onUnmounted, Transition } = window.Vue;
        const { createPinia, defineStore } = window.Pinia;
        const _ = window._;

        // --- 2. Pinia Store (æ•°æ®ä»“åº“) ---
        const useStatDataStore = defineStore("statData", () => {
          const statData = ref({});
          const loading = ref(true);
          const error = ref(null);

          function loadData() {
            try {
              if (typeof getVariables === "function" && typeof getCurrentMessageId === "function") {
                const vars = getVariables({ type: "message", message_id: getCurrentMessageId() }) || {};
                const n = _.get(vars, "stat_data", {});
                
                // å…è®¸ç©ºå¯¹è±¡ {}
                if (!n) { 
                  throw new Error("è·å–çš„çŠ¶æ€æ•°æ®æ— æ•ˆ (null or undefined)");
                }
                statData.value = n;
                error.value = null;
              } else {
                console.warn("æœªæ‰¾åˆ°å®¿ä¸» (getVariables) å‡½æ•°ã€‚UIå°†ä½¿ç”¨ç©ºæ•°æ®ã€‚");
                statData.value = {}; 
              }
            } catch (e) {
              console.error("åŠ è½½æ•°æ®å¤±è´¥:", e);
              error.value = e instanceof Error ? e.message : String(e);
              statData.value = {}; 
            } finally {
              loading.value = false;
            }
          }
          
          const r = (path, def) => _.get(statData.value, path, def);
          const c = (obj) => (obj && typeof obj === "object" ? _.omitBy(obj, (v, k) => k === "$meta" || k === "$__META_EXTENSIBLE__$") : {});
          const s = (val) => (Array.isArray(val) ? (val.length === 0 || val[0] === "$__META_EXTENSIBLE__$" ? [] : val) : (val || ""));

          return { statData, loading, error, loadData, r, c, s };
        });

        // --- 3. å®šä¹‰æ‰€æœ‰ç»„ä»¶ ---

        // [ç»„ä»¶] CommonStatus.vue
        const CommonStatus = defineComponent({
          template: `
            <div :class="classList" data-v-common-status>
              <div :class="['summary', { 'has-wrapped-summary': wrapped }]" @click="toggle" data-v-common-status>
                <div class="summary-main-line" data-v-common-status>
                  <i v-if="(icon || '').startsWith('fa-') || (icon || '').startsWith('iconfont')" 
                     :class="['icon-star', icon, { 'is-open': opened }]" data-v-common-status>
                  </i>
                  <span v-else :class="['icon-star', { 'is-open': opened }]" data-v-common-status>
                    {{ locked ? 'ğŸ”’' : (icon || 'âœ¦') }}
                  </span>
                  <span class="summary-title" data-v-common-status>
                    <slot name="title">{{ title }}</slot>
                  </span>
                  <span v-if="summaryDetails && !wrapped" class="summary-details" data-v-common-status>
                    {{ summaryDetails }}
                  </span>
                  <span :class="['arrow-toggle', { rotated: opened }]" data-v-common-status>â–¼</span>
                </div>
                <div v-if="summaryDetails && wrapped" class="summary-wrapped-details" data-v-common-status>
                  {{ summaryDetails }}
                </div>
              </div>
              <Transition name="collapse"
                @enter="onEnter"
                @after-enter="afterEnter"
                @leave="onLeave"
                @after-leave="afterLeave">
                <div class="details-content" v-show="opened" data-v-common-status>
                  <div class="details-content-inner" data-v-common-status>
                    <slot></slot>
                  </div>
                </div>
              </Transition>
            </div>
          `,
          props: {
            title: String,
            summaryDetails: { type: String, default: '' },
            defaultOpen: { type: Boolean, default: false },
            locked: { type: Boolean, default: false },
            variant: { type: String, default: 'section' },
            icon: { type: String, default: '' },
            customClass: { type: String, default: '' }
          },
          setup(props) {
            const opened = ref(props.defaultOpen);
            const innerWidth = ref(window.innerWidth);
            const onResize = () => { innerWidth.value = window.innerWidth; };
            onMounted(() => window.addEventListener('resize', onResize));
            onUnmounted(() => window.removeEventListener('resize', onResize));
            const wrapped = computed(() => {
              if (!props.summaryDetails) return false;
              const len = props.summaryDetails.length;
              return innerWidth.value <= 600 ? len > 10 : innerWidth.value <= 1000 ? len > 30 : len > 50;
            });
            const classList = computed(() => {
              const arr = ['details-status', `details-${props.variant}`];
              if (props.locked) arr.push('locked');
              if (opened.value) arr.push('is-open');
              if (props.customClass) arr.push(props.customClass);
              return arr.join(' ');
            });
            const toggle = () => { if (!props.locked) opened.value = !opened.value; };
            const onEnter = el => { el.style.height = '0'; el.style.overflow = 'hidden'; void el.offsetHeight; el.style.height = `${el.scrollHeight}px`; };
            const afterEnter = el => { el.style.height = ''; el.style.overflow = ''; };
            const onLeave = el => { el.style.height = `${el.scrollHeight}px`; el.style.overflow = 'hidden'; void el.offsetHeight; el.style.height = '0'; };
            const afterLeave = el => { el.style.height = ''; el.style.overflow = ''; };
            return { opened, wrapped, classList, toggle, onEnter, afterEnter, onLeave, afterLeave };
          }
        });

        // [ç»„ä»¶] WsHeader.vue
        const WsHeader = defineComponent({
          template: `
            <div class="scroll-header" data-v-header>
              <div class="master-ui-title" data-v-header>
                <h1 data-v-header>æ— åŒå¿—</h1>
              </div>
              <div class="scroll-poem-container" data-v-header>
                <h1 data-v-header>å®¿å‘½è¯—</h1>
                <div class="poem-grid" data-v-header>
                  <template v-if="lines.length === 0">
                    <p data-v-header>ï¼ˆæš‚æ— ï¼‰</p>
                  </template>
                  <template v-else v-for="(line, index) in lines" :key="index">
                     <p v-if="index % 2 === 0" data-v-header>{{ lines[index] || '...' }}</p>
                     <p v-if="index % 2 === 0" data-v-header>{{ lines[index + 1] || '...' }}</p>
                  </template>
                </div>
              </div>
            </div>
          `,
          setup() {
            const { r } = useStatDataStore();
            const lines = computed(() => {
              const arr = r('å¤©ä¸‹é—».å’å¹', ['ï¼ˆæš‚æ— è¯—ç¯‡ï¼‰']);
              const first = String(arr[0] || 'ï¼ˆæš‚æ— è¯—ç¯‡ï¼‰').replace(/\\\\n/g,'\n').replace(/\\n/g,'\n');
              return first.split('\n').filter(line => line.trim() !== '');
            });
            return { lines };
          }
        });

        // [ç»„ä»¶] WsWorld.vue
        const WsWorld = defineComponent({
          template: `
            <div class="world-status" data-v-world>
              <p class="world-info" data-v-world>
                <i class="iconfont icon-rili info-icon" data-v-world></i>
                <span class="info-label" data-v-world>æ—¶é—´:</span>
                <span class="value-main" data-v-world>{{ time }}</span>
              </p>
              <p class="world-info" data-v-world>
                <i class="iconfont icon-dizhiguanli info-icon" data-v-world></i>
                <span class="info-label" data-v-world>åœ°ç‚¹:</span>
                <span class="value-main" data-v-world>{{ place }}</span>
              </p>
            </div>
          `,
          setup() {
            const { r } = useStatDataStore();
            const time = computed(() => r('ä¸–ç•Œ.æ—¶é—´', ['æœªçŸ¥æ—¶é—´'])[0]);
            const place = computed(() => r('ä¸–ç•Œ.åœ°ç‚¹', ['æœªçŸ¥åœ°ç‚¹'])[0]);
            return { time, place };
          }
        });

        // [ç»„ä»¶] WsProtagonist.vue
        const WsProtagonist = defineComponent({
          components: { CommonStatus },
          template: `
            <CommonStatus title="ä¸»è§’" icon="iconfont icon-wode" :defaultOpen="true" data-v-char>
              <div class="ws-section-content" data-v-char>
                <div class="char-property-grid" data-v-char>
                  <template v-for="p in propsList" :key="p.k">
                    <i :class="[p.i, 'char-icon']" data-v-char></i>
                    <span class="char-prop-name" data-v-char>{{ p.k }}</span>
                    <span class="char-prop-value" data-v-char>{{ p.v }}</span>
                  </template>
                </div>
                <hr data-v-char />
                <h4 data-v-char>ä»™æœ¯/æŠ€èƒ½</h4>
                <template v-if="skills.length > 0">
                  <CommonStatus
                    v-for="([key, skill]) in skills"
                    :key="key"
                    :title="r(skill, 'åç§°', [key])[0]"
                    variant="sub-section"
                    data-v-char
                  >
                    <div class="ws-sub-section-content" data-v-char>
                      {{ r(skill, 'æè¿°', ['æš‚æ— æè¿°ã€‚'])[0] }}
                    </div>
                  </CommonStatus>
                </template>
                <p v-else class="empty-state-text">(ç©º)</p>
              </div>
            </CommonStatus>
          `,
          setup() {
            const { r, c } = useStatDataStore();
            const protagonist = computed(() => r('ä¸»è§’', {}));
            const propsList = computed(() => [
              { k: 'å£°æœ›', i: 'iconfont icon-shengwang', v: r(protagonist.value, 'å£°æœ›', ['--'])[0] },
              { k: 'å®˜èŒ', i: 'iconfont icon-guanmao', v: r(protagonist.value, 'å®˜èŒ', ['--'])[0] },
              { k: 'è¡€è„‰', i: 'iconfont icon-xiemai', v: r(protagonist.value, 'è¡€è„‰', ['--'])[0] },
              { k: 'æ­¦åŠ›', i: 'iconfont icon-gufengwujianzhongguofenggudaibingqijiangujian_huaban_huaban', v: r(protagonist.value, 'æ­¦åŠ›', [0])[0] },
              { k: 'è°‹ç•¥', i: 'iconfont icon-a-fenzu5', v: r(protagonist.value, 'è°‹ç•¥', [0])[0] },
              { k: 'é­…åŠ›', i: 'iconfont icon-meilizhi-copy', v: r(protagonist.value, 'é­…åŠ›', [0])[0] },
            ]);
            const skills = computed(() => Object.entries(c(r(protagonist.value, 'ä»™æœ¯[0]', {}))));
            return { protagonist, propsList, skills, r }; 
          }
        });
        
        // [ç»„ä»¶] WsHangnang.vue
        const WsHangnang = defineComponent({
          components: { CommonStatus },
          template: `
            <CommonStatus title="è¡Œå›Š" icon="iconfont icon-xingnang01" data-v-char>
              <div class="ws-section-content no-padding" data-v-char>
                <CommonStatus title="è£…å¤‡" variant="sub-section" :defaultOpen="true" data-v-char>
                  <div class="ws-sub-section-content" data-v-char>
                    <div class="char-property-grid" data-v-char>
                      <template v-for="o in equipList" :key="o.k">
                        <i :class="[o.i, 'char-icon']" data-v-char></i>
                        <span class="char-prop-name" data-v-char>{{ o.k }}</span>
                        <span class="char-prop-value" data-v-char>{{ o.v }}</span>
                      </template>
                    </div>
                  </div>
                </CommonStatus>
                <CommonStatus title="èƒŒåŒ…" variant="sub-section" data-v-char>
                   <div class="ws-sub-section-content" data-v-char>
                      <template v-if="bag.length > 0">
                        <div v-for="([key, item]) in bag" :key="key" class="item-row" data-v-char>
                          <span class="value-main">{{ r(item, 'åç§°', [key])[0] }}</span>
                          <span class="property-name">x {{ r(item, 'æ•°é‡', [0])[0] }}</span>
                        </div>
                      </template>
                      <p v-else class="empty-state-text">(ç©º)</p>
                   </div>
                </CommonStatus>
              </div>
            </CommonStatus>
          `,
          setup() {
            const { r, c } = useStatDataStore();
            const equip = computed(() => r('è¡Œå›Š.è£…å¤‡', {}));
            const equipList = computed(() => [
              // (æˆ‘ä»¬æ²¡æœ‰ä¸ºè¿™äº›å†…éƒ¨å›¾æ ‡é€‰æ‹© Iconfont, ä½ å¯ä»¥ä¹‹ååœ¨ Iconfont.cn æ·»åŠ å®ƒä»¬)
              { k: 'æ­¦å™¨', i: 'iconfont icon-gufengwujianzhongguofenggudaibingqijiangujian_huaban_huaban', v: r(equip.value, 'æ­¦å™¨', ['--'])[0] },
              { k:a: 'é˜²å…·', i: 'iconfont icon-yifu', v: r(equip.value, 'é˜²å…·', ['--'])[0] },
              { k: 'é¥°å“', i: 'iconfont icon-da-peishishipin', v: r(equip.value, 'é¥°å“', ['--'])[0] },
            ]);
            const bag = computed(() => Object.entries(c(r('è¡Œå›Š.èƒŒåŒ…[0]', {}))));
            return { equipList, bag, r }; 
          }
        });

        // [ç»„ä»¶] WsFates.vue
        const WsFates = defineComponent({
          components: { CommonStatus },
          template: `
            <CommonStatus title="ç»“ç¼˜å½•" icon="iconfont icon-yuanfen" data-v-char>
              <div class="ws-section-content no-padding" data-v-char>
                <template v-if="list.length > 0">
                  <CommonStatus
                    v-for="([key, person]) in list"
                    :key="key"
                    :title="r(person, 'å§“å', [key])[0]"
                    variant="sub-section"
                    :summaryDetails="'å¥½æ„Ÿ: ' + r(person, 'å¥½æ„Ÿåº¦', [0])[0]"
                    data-v-char
                  >
                    <div class="ws-sub-section-content" data-v-char>
                      ... (å†…å®¹å¾…å®ç°) ...
                    </div>
                  </CommonStatus>
                </template>
                <p v-else class="empty-state-text">(ç©º)</p>
              </div>
            </CommonStatus>
          `,
          setup() {
            const { r, c } = useStatDataStore();
            const list = computed(() => Object.entries(c(r('ç»“ç¼˜å½•[0]', {}))));
            return { list, r }; 
          }
        });

        // [ç»„ä»¶] WsNews.vue
        const WsNews = defineComponent({
          components: { CommonStatus },
          template: `
            <CommonStatus title="å¤©ä¸‹é—»" icon="iconfont icon-juanzhou--copy" data-v-char>
              <div class="ws-section-content no-padding" data-v-char>
                <CommonStatus title="å¥‡é—»" variant="sub-section" :defaultOpen="true" data-v-char>
                  <div class="ws-sub-section-content" data-v-news-content v-html="qiwens"></div>
                </CommonStatus>
                <CommonStatus title="å½“å‰å‰§æƒ…" variant="sub-section" :defaultOpen="true" data-v-char>
                   <div class="ws-sub-section-content" data-v-news-content>
                      {{ plot }}
                   </div>
                </CommonStatus>
              </div>
            </CommonStatus>
          `,
          setup() {
            const { r } = useStatDataStore();
            const qiwens = computed(() => String(r('å¤©ä¸‹é—».å¥‡é—»', ['ï¼ˆæš‚æ— å¥‡é—»ï¼‰'])[0]).replace(/\\n/g, '<br>'));
            const plot = computed(() => String(r('å¤©ä¸‹é—».å½“å‰å‰§æƒ…', ['ï¼ˆæš‚æ— å‰§æƒ…ï¼‰'])[0]));
            return { qiwens, plot };
          }
        });

        // --- 4. æ ¹ç»„ä»¶ App ---
        const App = defineComponent({
          components: { WsHeader, WsWorld, WsProtagonist, WsHangnang, WsFates, WsNews },
          template: `
            <div class="layout" data-v-app>
              <WsHeader />
              <WsWorld />
              <WsProtagonist />
              <WsHangnang />
              <WsFates />
              <WsNews />
            </div>
          `,
          setup() {
            const statDataStore = useStatDataStore();
            onMounted(() => {
              statDataStore.loadData();
            });
          }
        });

        // --- 5. å¯åŠ¨ App (ç”± bootloader è°ƒç”¨) ---
        try {
          const app = createApp(App);
          app.use(createPinia());
          app.mount('#app');
          console.log('--- [æ— åŒå¿— ä¼ ç»Ÿç‰ˆ] å·²å¯åŠ¨ ---');
        } catch (err) {
          console.error('å¯åŠ¨å¤±è´¥:', err);
          var appDiv = document.getElementById('app');
          if (appDiv) {
            appDiv.innerHTML = '<h3 style=\"color: red; font-family: sans-serif;\">å¯åŠ¨å¤±è´¥: ' + err.message + '</h3>';
          }
        }
      } // mountVueApp() ç»“æŸ
      
      // --- 6. å¯åŠ¨ Bootloader ---
      // (è¿™ä¸ªä¼šä¸€ç›´ç­‰åˆ° Vue, Pinia, Lodash åŠ è½½å®Œæ¯•)
      checkLibsAndBoot();

    })();
  </script>
</body>
</html>