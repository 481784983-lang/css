<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root{--ink:#1a1c20;--paper:#f0eee9;--red:#a63737;--gold:#cfaf70;--jade:#6fa0a0;--sub:#777;--f-art='Ma Shan Zheng',cursive;--f-body='Noto Serif SC',serif}
        body{margin:0;padding:0;overflow:hidden;background:transparent;font-family:var(--f-body)}
        
        /* [UI 容器] */
        #ui-stage{position:relative;width:100%;min-height:600px;overflow:hidden;border-radius:8px;background:var(--paper)}

        /* [开场动画] */
        .intro{position:absolute;inset:0;background:#111;z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--gold);overflow:hidden;transition:opacity 1.5s ease-in-out}
        .intro.out{opacity:0;pointer-events:none}
        .taiji-box{width:120px;height:120px;position:relative;animation:float 6s ease-in-out infinite}
        .taiji{width:100%;height:100%;border-radius:50%;background:conic-gradient(#fff 0% 50%,#000 50% 100%);border:2px solid #444;box-shadow:0 0 50px rgba(197,160,89,0.2);animation:spin 8s linear infinite;position:relative}
        .taiji::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:20px;height:20px;background:#000;border:20px solid #fff;border-radius:50%}
        .taiji::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:20px;height:20px;background:#fff;border:20px solid #000;border-radius:50%}
        .intro-txt{font-family:var(--f-art);font-size:2.5em;margin-top:40px;letter-spacing:10px;opacity:0;transform:scale(1.2) blur(10px);transition:all 1.5s cubic-bezier(0.22,1,0.36,1);text-shadow:0 0 20px var(--gold)}
        .intro-txt.in{opacity:1;transform:scale(1) blur(0)}
        .intro-sub{font-family:var(--f-body);font-size:0.9em;color:#666;margin-top:15px;opacity:0;transition:opacity 2s;letter-spacing:2px}
        .intro-sub.in{opacity:0.8}
        @keyframes spin{to{transform:rotate(360deg)}} @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

        /* [主界面] */
        .main{opacity:0;transform:translateY(30px);transition:all 1s cubic-bezier(0.22,1,0.36,1);width:100%;height:100%;background:var(--paper);display:flex;position:relative;overflow:hidden;border:1px solid #d4d0c4}
        .main.show{opacity:1;transform:translateY(0)}
        .main::before{content:"";position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:0.8}
        
        /* [左侧栏] */
        .left{width:35%;background:rgba(235,232,225,0.6);border-right:1px solid rgba(0,0,0,0.05);padding:20px;display:flex;flex-direction:column;align-items:center;position:relative;z-index:1;overflow-y:auto}
        .avatar-w{width:100px;height:100px;position:relative;display:flex;justify-content:center;align-items:center;margin-bottom:10px;flex-shrink:0}
        .avatar{width:100%;height:100%;border-radius:50%;background:#fff;border:4px double var(--ink);display:flex;justify-content:center;align-items:center;font-family:var(--f-art);font-size:3em;color:var(--ink);z-index:2;box-shadow:0 5px 15px rgba(0,0,0,0.1);transition:0.5s}
        .aura{position:absolute;inset:-10px;border-radius:50%;z-index:1;opacity:0;transition:1s}
        .aura.on{animation:pulse 4s infinite ease-in-out}
        .gold .aura{background:radial-gradient(var(--gold) 0,transparent 70%);opacity:0.6}.gold .avatar{border-color:var(--gold);color:var(--gold)}
        .red .aura{background:radial-gradient(var(--red) 0,transparent 70%);opacity:0.6}.red .avatar{border-color:var(--red);color:var(--red)}
        .purple .aura{background:radial-gradient(#9b59b6 0,transparent 70%);opacity:0.6}.purple .avatar{border-color:#9b59b6;color:#9b59b6}
        @keyframes pulse{0%,100%{transform:scale(0.9);opacity:0.4}50%{transform:scale(1.1);opacity:0.7}}

        .name{font-family:var(--f-art);font-size:2em;color:var(--ink);margin:5px 0;text-align:center}
        .race-tag{font-size:0.7em;background:var(--ink);color:#fff;padding:2px 8px;border-radius:2px;margin-bottom:15px;font-family:var(--f-body)}
        .stats{width:100%;background:rgba(255,255,255,0.5);border:1px solid rgba(0,0,0,0.05);padding:10px;border-radius:4px;font-size:0.85em}
        .row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px dashed rgba(0,0,0,0.1);color:var(--sub)}
        .row:last-child{border:0}.val{color:var(--red);font-weight:bold;font-family:var(--f-art)}
        .desc{margin-top:15px;font-size:0.8em;color:var(--sub);line-height:1.6;text-align:justify;font-style:italic;width:100%;border-left:3px solid var(--jade);padding-left:8px}

        /* [右侧栏] */
        .right{flex:1;padding:20px;overflow-y:auto;z-index:1;background:rgba(255,255,255,0.2)}
        .sec-h{font-family:var(--f-art);font-size:1.4em;color:var(--ink);border-bottom:2px solid var(--red);padding-bottom:5px;margin:20px 0 15px;display:flex;justify-content:space-between;align-items:flex-end}
        .sec-h:first-child{margin-top:0}.hint{font-family:var(--f-body);font-size:0.5em;color:var(--sub);font-weight:normal}
        
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
        .field{position:relative}
        .lbl{display:block;font-size:0.8em;color:var(--red);font-weight:bold;margin-bottom:5px}
        .grp{display:flex;gap:5px;align-items:center}
        
        .inp,.sel,.txt{width:100%;border:none;border-bottom:2px solid #ccc;background:transparent;padding:5px;font-family:var(--f-body);font-size:1em;color:var(--ink);transition:0.3s;border-radius:0}
        .inp:focus,.sel:focus,.txt:focus{border-color:var(--ink);background:rgba(255,255,255,0.5);outline:none}
        .sel{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='%23b83b3b'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 0 center}
        .btn-edit{width:30px;height:30px;border:1px solid #ccc;background:rgba(255,255,255,0.5);color:var(--sub);cursor:pointer;transition:0.2s;display:grid;place-items:center}
        .btn-edit:hover{color:var(--red);border-color:var(--red);background:#fff}
        .btn-edit.on{background:var(--red);color:#fff;border-color:var(--red)}
        .txt{height:80px;border:1px solid #ddd;padding:5px;background:rgba(255,255,255,0.4);border-radius:4px;resize:none}

        /* [新样式：列表与标签] */
        .comp-list{display:flex;flex-direction:column;gap:5px;max-height:200px;overflow-y:auto}
        .comp-item{display:flex;align-items:center;padding:8px;border:1px solid #ddd;border-radius:4px;cursor:pointer;transition:0.2s;background:rgba(255,255,255,0.3)}
        .comp-item:hover{background:#fff;border-color:var(--sub)}
        .comp-item.active{background:#fff8f0;border-color:var(--gold);box-shadow:0 2px 5px rgba(197,160,89,0.15)}
        .comp-rank{font-size:0.7em;background:var(--ink);color:#fff;padding:1px 5px;border-radius:2px;margin-right:8px;min-width:30px;text-align:center}
        .comp-info{flex:1;display:flex;flex-direction:column}
        .comp-name{font-weight:bold;font-size:0.9em;color:var(--ink)}
        .comp-desc{font-size:0.75em;color:var(--sub)}
        .rel-bar{display:flex;gap:4px;margin-top:5px;border-top:1px dashed #ccc;padding-top:5px;display:none}
        .comp-item.active .rel-bar{display:flex}
        .rel-btn{flex:1;font-size:0.75em;padding:2px 0;text-align:center;border:1px solid transparent;border-radius:2px;cursor:pointer;color:var(--sub);background:rgba(0,0,0,0.03)}
        .rel-btn:hover{background:#fff;border-color:#ccc}
        .rel-btn.active{background:var(--red);color:#fff}
        
        .foot{margin-top:30px;padding-top:20px;border-top:1px dashed #ccc;display:flex;gap:15px}
        .btn{flex:1;padding:12px;border:0;border-radius:4px;font-family:var(--f-art);font-size:1.2em;cursor:pointer;display:flex;justify-content:center;align-items:center;gap:5px;transition:0.3s}
        .btn-rnd{background:var(--paper);border:2px solid var(--gold);color:var(--gold)}.btn-rnd:hover{background:#fff}
        .btn-go{flex:2;background:var(--ink);color:#eaddcf}.btn-go:hover{background:var(--red);color:#fff}
        .hidden{display:none!important}
    </style>
</head>
<body>
    <div id="ui-stage"></div>
    <script>
    (function(){
        const R=requestAnimationFrame;const doc=document;const stage=doc.getElementById('ui-stage');
        // 2. 数据库 (大荒志·世界书深度适配版)
        const DB={
            "Global": {
                "Luck": [
                    {n:"灰名·炮灰", v:"gray", d:"喝水塞牙，开局被余波震死的路人甲"},
                    {n:"白名·凡骨", v:"white", d:"普普通通，在凡俗界安稳一生的命格"},
                    {n:"绿名·精英", v:"green", d:"小有天赋，在大虞皇朝能混个一官半职"},
                    {n:"蓝名·英杰", v:"blue", d:"一方豪杰，有希望能拜入万法阁内门"},
                    {n:"紫名·天骄", v:"purple", d:"机缘深厚，昆仑道宫争抢的真传种子"},
                    {n:"橙名·传说", v:"orange", d:"万古无一，镇压时代，有望冲击大乘境"},
                    {n:"红名·逆天", v:"red", d:"天道所妒，九死一生，每次渡劫都是死局"},
                    {n:"黑名·魔星", v:"black", d:"天煞孤星，克父克母克队友，独断万古"},
                    {n:"金名·主角", v:"gold", d:"天道私生子，跳崖捡神器，言出法随"}
                ],
                "Rel": [
                    {n:"路人", v:"stranger", d:"毫无交集，只是背景板", f:0},
                    {n:"恩人", v:"benefactor", d:"救命之恩，因果未还", f:20},
                    {n:"苦主", v:"victim", d:"你抢了他的机缘，他对你怀恨在心", f:-30},
                    {n:"青梅", v:"friend", d:"两小无猜，可惜没过‘心防’", f:25},
                    {n:"宿敌", v:"enemy", d:"大道之争，不死不休", f:-80},
                    {n:"债主", v:"debtor", d:"欠了天机阁一屁股债，被追杀中", f:-10},
                    {n:"婚约", v:"fiance", d:"指腹为婚，对方正准备上门退婚", f:40},
                    {n:"师徒", v:"master", d:"传道受业，一日为师终身为父", f:60},
                    {n:"主仆", v:"servant", d:"签订了灵魂契约，生死相随", f:90},
                    {n:"道侣", v:"partner", d:"打破心防，灵魂共鸣的半身", f:100}
                ]
            },
            "人族":{
                L:"灵根",
                R:[
                    "五行废灵根 (T0)","四属性伪灵根 (T2止步)","三属性真灵根 (T4有望)","金水双灵根","木火双灵根",
                    "天道筑基灵根","变异雷灵根","变异冰灵根","变异风灵根","极品金灵根 (昆仑种子)",
                    "极品火灵根 (炼丹天才)","空灵根 (空间天赋)","五行混沌体 (后期无敌)","光暗双生根","天生剑胎"
                ],
                B:[
                    "凡人之躯","天生神力","纯阴之体","纯阳之体","剑心通明 (昆仑)","先天道体 (T9预定)","荒古圣体 (战皇殿)",
                    "苍天霸体","九阴绝脉 (活不过20)","厄难毒体","五行灵体","丹心琉璃体 (万法阁)","蛮荒武体",
                    "破妄法眼","长生仙体","无垢灵体"
                ],
                P:[
                    "大虞京城·贫民窟","青竹村·老家","昆仑道宫·杂役处","万法阁·炼丹房","战皇殿·演武场",
                    "戒指空间·残魂旁","落魄家族·柴房","边境军营·死人堆","繁华青楼·后院","深山猎户·木屋",
                    "隐世桃源","凡人书院","修仙坊市·地摊","古井底部","悬崖山洞","大虞皇宫·冷宫"
                ],
                I:[
                    "生锈的铁剑","神秘的黑戒指","一封退婚书","半块麒麟玉佩","家传的古灯","破旧的道袍",
                    "一只秃毛黑狗","青铜小鼎","半卷残经","神秘小绿瓶","染血的绣花鞋","一把杀猪刀",
                    "不知名的种子","一块黑色石头","一张藏宝图","奇怪的木偶","一枚大虞通宝","天机阁欠条"
                ],
                D:[
                    "相貌平平，唯有一双眸子亮得惊人，透着坚毅。",
                    "一袭白衣胜雪，气质儒雅随和，宛如昆仑谪仙。",
                    "衣衫褴褛，蓬头垢面，却难掩眉宇间的英气。",
                    "面容清秀，文质彬彬，看起来像个进京赶考的书生。",
                    "虎背熊腰，满脸横肉，血气惊人，像战皇殿的莽夫。",
                    "容貌绝美，气质清冷，仿佛不食人间烟火的仙子。",
                    "嘴角挂着玩世不恭的笑意，眼神却深不可测。",
                    "脸色苍白如纸，身形单薄，仿佛随时会咳血的病鬼。",
                    "五官端正，一身正气，让人一看就心生好感。",
                    "其貌不扬，丢在人群中绝对找不出来，毫无存在感。"
                ],
                C:[
                    {n:"小芳", t:"凡人", d:"邻家少女，厨艺一绝，在大虞京城等你 (T0)"},
                    {n:"秦破军", t:"炼体", d:"大虞镇国大将军，凡人武道极致 (T2)"},
                    {n:"公孙衍", t:"筑基", d:"皇朝首席供奉，贪财好色的老油条 (T3)"},
                    {n:"林婉儿", t:"筑基", d:"昆仑小师妹，虽然菜但爱玩，喜欢粘着你 (T3)"},
                    {n:"公输巧", t:"金丹", d:"万法阁傀儡天才，喜欢拆东西的眼镜娘 (T4)"},
                    {n:"金玉真人", t:"元婴", d:"天机阁黑市女王，富可敌国 (T5)"},
                    {n:"冷霜月", t:"元婴", d:"昆仑大师姐，剑心通明，高岭之花 (T5)"},
                    {n:"铁牛", t:"元婴", d:"战皇殿首席，金刚霸体，憨厚能打 (T5)"},
                    {n:"虞昭宗", t:"帝王", d:"大虞皇帝，虽然是凡人但有龙气护体 (T?)"},
                    {n:"千机散人", t:"大乘", d:"活化石级别的阵法宗师，躲在迷雾群岛 (T8)"},
                    {n:"叶老头", t:"残魂", d:"戒指里的老爷爷，整天吹嘘自己当年多牛 (T?)"}
                ]
            },
            "妖族":{
                L:"血脉",
                R:[
                    "杂血野兽 (T1)","低阶妖兽","上古异种混血","青丘九尾血脉","啸月天狼血脉","太古真龙血脉","金翅大鹏血脉",
                    "通臂猿猴血脉","深海玄龟血脉","烈焰狂狮","吞天巨蟒","幽冥灵猫","三足金乌混血","七彩孔雀",
                    "撼地魔牛","碧眼金睛兽","远古腾蛇","极寒雪豹","虚空影鼠"
                ],
                B:[
                    "未化形野兽","半化形(保留兽耳)","完全化形","不灭妖体","上古战体","魅惑妖躯 (狐族)",
                    "返祖魔躯","钢筋铁骨","浴火重生","天生神速","剧毒之躯","水元素体","厚土之身",
                    "风雷双翼","吞噬魔体 (万妖盟)","百变妖身"
                ],
                P:[
                    "十万大山·外围瘴气林","十万大山·万兽谷","万妖盟·妖皇殿","深海龙宫","盘丝洞",
                    "人族御兽宗·笼子","上古大妖洞府","蛮荒古林","人类城市下水道","马戏团",
                    "神秘蛋壳","寒冰深渊","烈火岩浆","巨树树冠","妖族祭坛"
                ],
                I:[
                    "伴生骨刺","先祖遗骨","化形草","人族修士的染血法袍","一条红肚兜","本命翎羽",
                    "一颗龙珠(伪)","断裂的象牙","神秘兽皮卷","半截锁妖链","妖皇令牌",
                    "隐匿妖气的玉佩","人类的诗集","一根猴毛","发光的鱼鳞","先祖的牙齿"
                ],
                D:[
                    "保留着毛茸茸的兽耳和尾巴，野性难驯，喜欢龇牙。",
                    "化形绝美，天生媚骨，一颦一笑都勾人心魄。",
                    "身躯魁梧，皮肤上覆盖着细密的鳞片，充满力量感。",
                    "双目竖瞳，闪烁着冰冷的凶光，让人不寒而栗。",
                    "看起来像个粉雕玉琢的小娃娃，实际上是一口一个小朋友的凶兽。",
                    "背生双翼，眼神锐利如鹰，仿佛随时会扑杀猎物。",
                    "慵懒地趴在地上，对什么都提不起劲，像只晒太阳的大猫。",
                    "全身笼罩在黑袍中，只露出一双发绿的眼睛。"
                ],
                C:[
                    {n:"小灵狐", t:"妖兽", d:"只会嘤嘤嘤的毛绒团子，除了卖萌啥也不会 (T1)"},
                    {n:"虎妞", t:"妖兽", d:"一只傻乎乎的母老虎，把你当做储备粮 (T1)"},
                    {n:"猫娘·铃铛", t:"化形", d:"傲娇的猫耳娘，喜欢偷吃你的丹药 (T4)"},
                    {n:"万兽姥姥", t:"金丹", d:"带着三只化神战宠的恐怖萝莉 (T4)"},
                    {n:"孔宣", t:"妖将", d:"自恋的孔雀妖，每天要照镜子八百次 (T5)"},
                    {n:"苏九", t:"元婴", d:"九尾天狐，魅惑众生，也是个老司姬 (T5)"},
                    {n:"金刚猿王", t:"化神", d:"万妖盟战王，脑子里只有打架 (T6)"},
                    {n:"千面狐主", t:"合体", d:"万妖盟军师，潜伏在人族京城的卧底 (T7)"},
                    {n:"吞天妖王", t:"大乘", d:"万妖盟主，想吞噬天地的疯子 (T8)"},
                    {n:"混元妖圣", t:"渡劫", d:"闭死关的老祖宗，动一下就会爆炸 (T9)"}
                ]
            },
            "鬼族":{
                L:"魂格",
                R:[
                    "残缺游魂","地缚灵","百年怨灵","红衣厉鬼","修罗战魂","幽冥皇族","黄泉摆渡人",
                    "无常鬼使","判官后裔","千年僵尸","极阴鬼煞","替死鬼","饿死鬼","水鬼",
                    "吊死鬼","画中鬼","镜中鬼","旱魃血脉"
                ],
                B:[
                    "虚无魂体","半实半虚","凝实鬼躯","夺舍肉身","画皮之躯","千年不化骨",
                    "飞天夜叉身","金刚尸身","幽冥鬼体","无头鬼躯","千眼鬼躯","影子状态",
                    "附身傀儡","纸人替身","白骨法身"
                ],
                P:[
                    "古战场·哭嚎平原","古战场·断魂谷","幽都·枉死城","乱葬岗","奈何桥边",
                    "阴煞地脉","废弃古宅","深山义庄","万人坑","极阴之地","槐树林",
                    "古墓主室","大虞皇陵·裂隙","鬼市角落","画卷之中"
                ],
                I:[
                    "哭丧棒","残破墓碑","一碗孟婆汤","一叠死人钱","红绣鞋","勾魂锁链",
                    "生死簿残页","引魂灯","骨灰盒","招魂幡","染血的嫁衣","镇魂钉",
                    "棺材板","彼岸花","人皮灯笼","阴兵虎符"
                ],
                D:[
                    "身体半透明，飘忽不定，散发着阵阵寒气。",
                    "面色惨白如纸，没有影子，脚后跟不着地。",
                    "一身红衣似火，黑发遮面，怨气冲天，周围温度骤降。",
                    "青面獠牙，身形高大，看起来凶神恶煞。",
                    "看起来和常人无异，只有在照镜子时才没有倒影。",
                    "全身由白骨组成，眼眶中跳动着幽蓝的鬼火。",
                    "提着自己的头颅，漫无目的地游荡着。",
                    "像个可爱的瓷娃娃，但皮肤冰冷僵硬，毫无生机。"
                ],
                C:[
                    {n:"游魂小倩", t:"游魂", d:"迷迷糊糊的亡灵，连自己怎么死的都忘了 (T1)"},
                    {n:"红衣女", t:"厉鬼", d:"怨气冲天的新娘，每天都在找负心汉 (T2)"},
                    {n:"僵尸道长", t:"跳僵", d:"生前是道士，死后变僵尸，还在坚持画符 (T3)"},
                    {n:"画皮苏三", t:"鬼将", d:"每天换脸的绝色画皮，想披上你的人皮 (T4)"},
                    {n:"白无常", t:"鬼差", d:"笑眯眯的勾魂使者，总想把你带走冲业绩 (T5)"},
                    {n:"黑山老妖", t:"鬼王", d:"本体是一座移动的白骨山 (T6)"},
                    {n:"孟婆", t:"鬼王", d:"忘川边的神秘少女，熬的汤其实很难喝 (T6)"},
                    {n:"忘川摆渡人", t:"合体", d:"只要给记忆，就能渡你去彼岸 (T7)"},
                    {n:"酆都鬼帝", t:"大乘", d:"幽都统治者，企图建立地上鬼国 (T8)"},
                    {n:"转轮鬼圣", t:"渡劫", d:"试图重塑轮回的古老存在 (T9)"}
                ]
            },
            "魔族":{
                L:"魔源",
                R:[
                    "低等劣魔","魅魔血统","影魔","炎魔","冰魔","天魔皇族","罗刹族","修罗族",
                    "夜叉族","血魔","骨魔","梦魇","深渊恶魔","堕落天使","域外天魔","混沌魔种"
                ],
                B:[
                    "凡人魔胎","初阶魔躯","天魔不灭身","万毒魔体","嗜血战体","魅惑魔体 (合欢)",
                    "深渊吞噬体","岩浆魔躯","三头六臂","金刚不坏魔身","幽冥魔瞳","堕落圣体"
                ],
                P:[
                    "幽冥魔海·黑血沼泽","幽冥魔海·万魔殿","无间魔宗·血池","深渊裂隙",
                    "域外战场","魔神祭坛","堕落之地","黑暗森林","地下魔城",
                    "正道宗门的禁地","火山深处","魔兽巢穴","白骨王座"
                ],
                I:[
                    "吸血匕首","万魂幡","魔神雕像","人皮面具","魔血石","献祭法阵图",
                    "堕落圣杯","魔龙之牙","骷髅戒指","黑色斗篷","灵魂契约书","剧毒魔药"
                ],
                D:[
                    "双目赤红，额头生有弯曲的魔角，散发着暴虐的气息。",
                    "皮肤呈紫黑色，遍布诡异的魔纹，闪烁着暗光。",
                    "外表妖艳绝伦，身材火辣，眼神中充满了贪婪和欲望。",
                    "浑身笼罩在黑雾之中，看不清面容，只有两点红光。",
                    "长着巨大的蝙蝠翅膀，獠牙外露，如同地狱恶鬼。",
                    "看起来温文尔雅，但影子却是扭曲的怪物形状。",
                    "全身燃烧着地狱黑火，所过之处化为焦土。"
                ],
                C:[
                    {n:"哑女", t:"凡人", d:"魔教祭坛的逃生者，眼神中藏着秘密 (T1)"},
                    {n:"小魔头", t:"练气", d:"无法无天的魔宗少主，喜欢搞破坏 (T2)"},
                    {n:"合欢弟子", t:"筑基", d:"精通双修的妖女，想把你采补一空 (T3)"},
                    {n:"厉九幽", t:"元婴", d:"魔宗魔子，深渊吞噬体，冷霜月的宿敌 (T5)"},
                    {n:"无罪", t:"化神", d:"只杀恶人的魔道异类，正魔两道通缉犯 (T6)"},
                    {n:"苏千欢", t:"合体", d:"魔门魅魔圣女，欲魔女，裙下之臣无数 (T7)"},
                    {n:"幽冥魔主", t:"大乘", d:"无间魔宗宗主，正在策划血祭大阵 (T8)"},
                    {n:"无情剑魔", t:"化神", d:"为了剑道杀妻证道的疯子，现在有点后悔 (T6)"},
                    {n:"万魔之祖", t:"渡劫", d:"接引域外魔神的罪魁祸首，无法移动 (T9)"},
                    {n:"心魔", t:"无形", d:"你内心的阴暗面，总是诱惑你堕落 (T?)"}
                ]
            },
            "半妖":{
                L:"混血",
                R:[
                    "血脉驳杂","返祖现象","半龙血脉","半凤血脉","半狐血脉","半狼血脉","半蛇血脉",
                    "半鱼人","半蛛人","半虎人","人妖嵌合体","改造失败品"
                ],
                B:[
                    "半妖之躯","狂化体质","异瞳之体","排斥反应","双重丹田","妖力封印",
                    "残缺肢体","机械义肢","兽化左臂","鳞片覆盖","半能量化"
                ],
                P:[
                    "人妖边境缓冲带","奴隶市场","地下斗兽场","贫民窟","被遗弃的村庄",
                    "黑市实验室","深山老林","杂技团后台","下水道深处"
                ],
                I:[
                    "断裂的项圈","母亲的画像","半块妖牌","遮掩妖气的斗篷","劣质疗伤药",
                    "一把磨锋利的骨刀","半本人类功法","半本妖族战技","奴隶契约复印件"
                ],
                D:[
                    "虽然是人身，却有着竖瞳，给人一种凄美而诡异的感觉。",
                    "卑微隐忍，身上满是伤痕，为了生存可以不择手段。",
                    "平时看着像人，一发怒就会长出獠牙和利爪。",
                    "戴着厚厚的帽子遮住兽耳，眼神总是躲躲闪闪。",
                    "半边脸是绝世容颜，半边脸覆盖着狰狞的鳞片。",
                    "脖子上带着无法取下的项圈，那是奴隶的证明。"
                ],
                C:[
                    {n:"阿呆", t:"奴隶", d:"和你同一个笼子里的半妖少年，傻人有傻福 (T1)"},
                    {n:"狼女", t:"斗士", d:"斗兽场里的连胜冠军，野性十足 (T3)"},
                    {n:"药师", t:"筑基", d:"研究自身血脉的疯狂医生，拿自己做实验 (T3)"},
                    {n:"混江龙", t:"结丹", d:"半龙半人的水匪头子，讲究江湖道义 (T4)"},
                    {n:"涂山弃徒", t:"元婴", d:"被青丘驱逐的半狐，发誓要报复回去 (T5)"},
                    {n:"无名氏", t:"杀手", d:"利用半妖特性暗杀的高手，只认钱不认人 (T4)"},
                    {n:"蛮", t:"合体", d:"战皇殿叛徒，以妖为食的‘无枷者’ (T7)"},
                    {n:"阿满", t:"大乘", d:"凡人成圣的武道巅峰，免疫灵魂攻击 (T8)"}
                ]
            },
            "灵族":{
                L:"本体",
                R:[
                    "顽石通灵","万年古树","彼岸花精","上古剑灵","丹药化形","火焰之灵","极寒冰灵",
                    "雷霆之灵","书本成精","玉石琵琶精","千年人参娃娃","山川地脉之灵"
                ],
                B:[
                    "元素之躯","纯净灵体","法宝本体","草木之身","金石之躯","无垢琉璃体",
                    "百毒不侵","虚实转换","寄生体","液态之躯","灵气源泉"
                ],
                P:[
                    "万法阁·药园","昆仑道宫·剑冢","火山核心","极地冰原","雷池深处",
                    "藏书阁顶层","炼丹炉内","玉石矿脉","深山古刹","灵河之底"
                ],
                I:[
                    "伴生灵液","本体残片","自然之息","一滴仙露","古老的剑鞘","丹方残页",
                    "万年树心","火焰结晶","雷击木","一本无字天书","破碎的玉佩"
                ],
                D:[
                    "身上散发着淡淡的草木清香，让人闻之心旷神怡。",
                    "身体晶莹剔透，仿佛由最纯净的水晶雕琢而成。",
                    "头发是燃烧的火焰，双眼如同两颗璀璨的宝石。",
                    "看起来是个小娃娃，但头顶长着几片嫩绿的叶子。",
                    "浑身散发着凌厉的剑气，生人勿近。"
                ],
                C:[
                    {n:"小草", t:"精怪", d:"一株刚开智的小草，只会喊“好渴好渴” (T1)"},
                    {n:"参爷", t:"精怪", d:"怕死的人参娃娃，跑得比谁都快，浑身是宝 (T2)"},
                    {n:"剑痴", t:"剑灵", d:"一把古剑的剑灵，除了练剑啥也不懂 (T3)"},
                    {n:"花仙子", t:"筑基", d:"管理百花园的温柔姐姐，喜欢送你花蜜 (T3)"},
                    {n:"石敢当", t:"结丹", d:"一块顽石成精，憨厚老实，防御力点满 (T4)"},
                    {n:"炎魔", t:"元婴", d:"异火化形，脾气火爆，一言不合就自爆 (T5)"},
                    {n:"书灵", t:"化神", d:"藏书阁的管理者，知晓天下万事，有点啰嗦 (T6)"},
                    {n:"器尊", t:"合体", d:"上古神器的器灵，正在寻找新的主人 (T7)"},
                    {n:"丹魔", t:"异类", d:"废丹产生的怨念集合体，剧毒无比 (T5)"}
                ]
            }
        };
        
        DB["半妖"].C=DB["妖族"].C; DB["灵族"].C=DB["人族"].C;

        const I=i=>doc.getElementById(i);
        const V=i=>{const c=I(i+'_c');return(c&&!c.classList.contains('hidden'))?(c.value||"未知"):I(i).value};
        const P=(i,o)=>{const e=I(i);e.innerHTML='';o.forEach(v=>{const p=doc.createElement('option');p.value=v;p.innerText=v;e.appendChild(p)});e.selectedIndex=Math.floor(Math.random()*Math.min(3,o.length))};
        let curComp=null; let curRel=null;

        const U=()=>{
            const n=I('i_nm').value||"无名",a=I('i_ag').value,r=I('i_rc').value;
            I('v_ag').innerText=a;I('p_av').innerText=n.charAt(0);I('p_nm').innerText=n;
            I('p_rd').innerText=`${r} · ${a}岁`;
            I('p_rt').innerText=V('i_rt');I('p_bd').innerText=V('i_bd');
            I('p_cl').innerText=V('i_cl');I('p_lc').innerText=V('i_lc');
            I('p_ds').innerText=I('i_ds').value||"暂无描述";
            const w=I('p_aw');w.className='avatar-w';
            const rv=V('i_rt'),bv=V('i_bd');
            if(rv.includes('天')||rv.includes('道')||rv.includes('龙'))w.classList.add('gold');
            else if(bv.includes('魔')||r==='魔族'||r==='鬼族')w.classList.add('red');
            else if(rv.includes('灵')||r==='灵族'||r==='妖族')w.classList.add('purple');
            w.querySelector('.aura').classList.add('on');
        };

        const RC=()=>{
            const r=I('i_rc').value,c=DB[r]||DB["人族"];
            I('l_rt').innerText=c.L;P('i_rt',c.R);P('i_bd',c.B);P('i_lc',c.P);P('i_it',c.I);
            I('i_ds').value=c.D[Math.floor(Math.random()*c.D.length)];
            const cl=I('comp_root');
            if(cl){
                cl.innerHTML=c.C.map((p,i)=>`
                    <div class="comp-item" onclick="SelComp(this, ${i})">
                        <div class="comp-rank">T${i+1}</div>
                        <div class="comp-info"><div class="comp-name">${p.n}</div><div class="comp-desc">${p.d}</div></div>
                        <div class="rel-bar">
                            ${DB.Global.Rel.map(rl=>`<div class="rel-btn" onclick="SelRel(event,this,'${rl.v}')">${rl.n}</div>`).join('')}
                        </div>
                    </div>`).join('');
            }
            curComp=null;curRel=null;U();
        };

        window.SelComp=(el,idx)=>{
            doc.querySelectorAll('.comp-item').forEach(e=>e.classList.remove('active'));
            el.classList.add('active');
            curComp=DB[I('i_rc').value].C[idx];
            el.querySelector('.rel-btn').click();
        };
        window.SelRel=(e,el,key)=>{
            e.stopPropagation();
            doc.querySelectorAll('.rel-btn').forEach(b=>b.classList.remove('active'));
            el.classList.add('active');
            curRel=DB.Global.Rel.find(r=>r.v===key);
        };

        const RN=()=>{
            const r=Math.random();let v="人族";
            if(r>.9)v="灵族";else if(r>.8)v="魔族";else if(r>.7)v="鬼族";else if(r>.5)v="妖族";
            I('i_rc').value=v;RC();
            const n=["叶凡","韩立","白小纯","方寒","王林","苏清寒","林动"];
            I('i_nm').value=n[Math.floor(Math.random()*n.length)];
            I('i_ag').value=Math.floor(Math.random()*15)+10;U();
        };

        const SB=()=>{
            const d={name:I('i_nm').value,age:I('i_ag').value,race:I('i_rc').value,gender:V('i_gd'),root:V('i_rt'),body:V('i_bd'),cult:V('i_cl'),loc:V('i_lc'),desc:I('i_ds').value,item:V('i_it'),luck:V('i_lk')};
            const compTxt = curComp ? `\n【初始羁绊】\n伙伴：${curComp.n} (${curComp.t})\n关系：${curRel.n} (${curRel.d})\n` : "";
            const t=`\n[系统指令：自定义开局]\n请根据设定开始修真故事。\n\n【角色档案】\n姓名：${d.name} (${d.gender}, ${d.age}岁)\n种族：${d.race}\n命格：${d.luck}\n修为：${d.cult}\n地点：${d.loc}\n\n【天赋设定】\n灵根：${d.root}\n体质：${d.body}\n随身：${d.item}${compTxt}\n\n【生平】\n${d.desc}\n\n【要求】\n作为DM，描写${d.name}在${d.loc}的开场。体现古典修真风格。`;
            try{
                const z=window.parent.document.getElementById('send_textarea');
                if(z){z.value=t;z.dispatchEvent(new Event('input',{bubbles:true}));
                const b=I('b_go');b.innerHTML='入世中...';setTimeout(()=>b.innerHTML='以此身入世',2000);}
                else{navigator.clipboard.writeText(t);alert("指令已复制");}
            }catch(e){console.error(e);}
        };

        const frames=[
            ()=>{stage.innerHTML=`<div class="intro" id="intro"><div class="taiji-box"><div class="taiji"></div></div><div class="intro-txt" id="it1">道生一 · 一生二</div><div class="intro-sub" id="it2">三生万物 · 万物负阴而抱阳</div></div>`},
            ()=>{setTimeout(()=>{I('it1').classList.add('in')},300);setTimeout(()=>{I('it2').classList.add('in')},1000)},
            ()=>{stage.insertAdjacentHTML('beforeend',`<div class="main" id="ui-main"><div class="left"><div class="avatar-w" id="p_aw"><div class="aura"></div><div class="avatar" id="p_av">道</div></div><div class="name" id="p_nm"></div><div class="race-tag" id="p_rd"></div><div class="stats"><div class="row"><span class="k">天赋</span><span class="val" id="p_rt"></span></div><div class="row"><span class="k">体质</span><span class="val" id="p_bd"></span></div><div class="row"><span class="k">修为</span><span class="val" id="p_cl"></span></div><div class="row"><span class="k">地点</span><span class="val" id="p_lc"></span></div></div><div class="desc" id="p_ds"></div></div><div class="right" id="cp_root"></div></div>`)},
            ()=>{I('cp_root').innerHTML=`<div class="sec-h"><span>壹 · 真名与种族</span><span class="hint">Origin</span></div><div class="grid"><div class="field"><span class="lbl">姓名 Name</span><input type="text" id="i_nm" class="inp" value="叶凡"></div><div class="field"><span class="lbl">种族 Race</span><div class="grp"><select id="i_rc" class="sel"><option value="人族">人族</option><option value="妖族">妖族</option><option value="半妖">半妖</option><option value="鬼族">鬼族</option><option value="魔族">魔族</option><option value="灵族">灵族</option></select></div></div></div><div class="grid" style="margin-top:20px"><div class="field"><span class="lbl">性别 Gender</span><div class="grp"><select id="i_gd" class="sel"><option value="男">男</option><option value="女">女</option><option value="无性">无性</option></select></div></div><div class="field"><span class="lbl">骨龄 Age</span><div class="slider-w"><input type="range" id="i_ag" style="flex:1;accent-color:var(--red)" min="0" max="1000" value="16"><span class="val" id="v_ag" style="width:40px;text-align:right">16</span></div></div></div>`},
            ()=>{I('cp_root').insertAdjacentHTML('beforeend',`<div class="sec-h"><span>贰 · 根骨与命格</span><span class="hint">Talent</span></div><div class="grid"><div class="field"><span class="lbl" id="l_rt">灵根</span><div class="grp"><select id="i_rt" class="sel"></select><button class="btn-edit" data-t="i_rt"><i class="fa-solid fa-pen"></i></button><input type="text" id="i_rt_c" class="inp hidden" placeholder="自定义..."></div></div><div class="field"><span class="lbl">体质 Physique</span><div class="grp"><select id="i_bd" class="sel"></select><button class="btn-edit" data-t="i_bd"><i class="fa-solid fa-pen"></i></button><input type="text" id="i_bd_c" class="inp hidden" placeholder="自定义..."></div></div></div><div class="grid" style="margin-top:20px"><div class="field"><span class="lbl">修为 Cultivation</span><div class="grp"><select id="i_cl" class="sel"><option value="凡人">凡人</option><option value="炼体一层">炼体一层</option><option value="炼体巅峰">炼体巅峰</option><option value="筑基初期">筑基初期</option><option value="金丹初期">金丹初期</option><option value="元婴老怪">元婴老怪</option></select></div></div><div class="field"><span class="lbl">天命气运 Luck</span><div class="grp"><select id="i_lk" class="sel">${DB.Global.Luck.map(l=>`<option value="${l.n}">${l.n}</option>`).join('')}</select></div></div></div>`)},
            ()=>{I('cp_root').insertAdjacentHTML('beforeend',`<div class="sec-h"><span>叁 · 初始羁绊</span><span class="hint">Bonds</span></div><div id="comp_root" class="comp-list"></div>`)},
            ()=>{I('cp_root').insertAdjacentHTML('beforeend',`<div class="sec-h" style="margin-top:30px"><span>肆 · 入世机缘</span><span class="hint">Story</span></div><div class="grid"><div class="field"><span class="lbl">伴生之物 Item</span><div class="grp"><select id="i_it" class="sel"></select><button class="btn-edit" data-t="i_it"><i class="fa-solid fa-pen"></i></button><input type="text" id="i_it_c" class="inp hidden" placeholder="自定义..."></div></div><div class="field"><span class="lbl">出生地 Location</span><div class="grp"><select id="i_lc" class="sel"></select><button class="btn-edit" data-t="i_lc"><i class="fa-solid fa-pen"></i></button><input type="text" id="i_lc_c" class="inp hidden" placeholder="自定义..."></div></div></div><div class="field" style="margin-top:20px"><span class="lbl">外貌与生平 Background</span><textarea id="i_ds" class="txt"></textarea></div><div class="foot"><button class="btn btn-rnd" id="b_rng"><i class="fa-solid fa-dice-d20"></i> 天道骰子</button><button class="btn btn-go" id="b_go"><i class="fa-solid fa-signature"></i> 以此身入世</button></div>`)},
            ()=>{
                I('i_rc').onchange=RC;I('i_nm').oninput=U;I('i_ag').oninput=()=>{I('v_ag').innerText=I('i_ag').value;U()};
                I('i_rt').onchange=U;I('i_bd').onchange=U;I('i_cl').onchange=U;I('i_lc').onchange=U;I('i_it').onchange=U;I('i_ds').oninput=U;I('i_lk').onchange=U;
                doc.querySelectorAll('.btn-edit').forEach(b=>{b.onclick=function(){const i=this.dataset.t,s=I(i),c=I(i+'_c');if(c.classList.contains('hidden')){s.classList.add('hidden');c.classList.remove('hidden');this.classList.add('on');c.focus()}else{c.classList.add('hidden');s.classList.remove('hidden');this.classList.remove('on');U()}}});
                I('b_rng').onclick=RN;I('b_go').onclick=SB;RC();
                setTimeout(()=>{I('intro').classList.add('out');I('ui-main').classList.add('show')},2200)
            }
        ];
        const run=()=>{if(frames.length)R(()=>{frames.shift()();run()})};run();
    })();
    </script>
</body>
</html>
